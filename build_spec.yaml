version: 0.1          # debe ser exactamente 0.1
component: build      # indica que esto es un build spec

timeoutInSeconds: 3600  # opcional, tiempo mÃ¡ximo de ejecuciÃ³n (1 h)

steps:
  - type: Command
    name: Build Java artifact
    command: |
      echo "ðŸ”§ Instalando Maven..."
      yum install -y maven

      echo "ðŸ“¦ Compilando el proyecto con Maven..."
      cd MtdrSpring/backend
      mvn -B \
        -Dmaven.multiModuleProjectDirectory="$(pwd)" \
        clean package spring-boot:repackage
        
  - type: Command
    name: Construir imagen
    command: |
      echo "ðŸ”¨ Construyendo imagen Docker..."
      cd MtdrSpring/backend
      docker build \
        -t iad.ocir.io/axm8kysebnqa/reacttodo/s78fu/todolistapp-springboot:${image_tag} \
        -f Dockerfile \
        .

  - type: Command
    name: Subir imagen
    command: |
      echo "Pushing imagen a OCIR..."
      docker push iad.ocir.io/axm8kysebnqa/reacttodo/s78fu/todolistapp-springboot:${image_tag}

outputArtifacts:
  - name: todolist-image
    type: DOCKER_IMAGE
    location: iad.ocir.io/axm8kysebnqa/reacttodo/s78fu/todolistapp-springboot:${image_tag}
